<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Komunikator</title>
    <link rel="stylesheet" href="Content/Site.min.css">

    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
<aside data-bind="template:{ name: 'chanel-list-template', data: $data }">

</aside>
<main>
    <header>Super Mega Neo Climax Ultimate <del>Boy</del> Chat</header>
    <section id="messages-section" data-bind="template:{name: 'chanel-template', data: SelectedChanel }">

    </section>
    <section id="new-message-section" data-bind="template:{name: 'new-message-template', data: $data }">

    </section>
</main>

<div class="templates">
    <script type="text/html" id="chanel-list-template" src="Views/chanel-list.html"></script>
    <script type="text/html" id="chanel-template" src="Views/chanel.html"></script>
    <script type="text/html" id="new-message-template" src="Views/new-message.html"></script>
</div>
<div class="scripts">
    <script src="Scripts/Libs.min.js"></script>
    <script src="Scripts/KoApp.js"></script>
    <script src="Scripts/App.js"></script>

    <script type="text/javascript">
        function LoadScriptInline(element) {
            return new Promise(function(resolve, reject) {
                var $element = jQuery(element);
                var url = $element.attr('src');
                $element.attr("src", "");
                $element.load(url,
                    function(response, status, xhr) {
                        status === "success" ? resolve() : reject([element, url, xhr]);
                    });
            });
        }

        function InitializeKO() {
            var model = new ChatVM();
            Chat.applyBindings(model);
        }

        Promise.all($('script[type="text/html"][src]').map(function() { return LoadScriptInline(this); }).get())
            .then(InitializeKO)
            .catch(function(element) { console.error("Problem with loading template", element); });
    </script>
</div>
</body>
</html>